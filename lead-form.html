<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead Intake Form</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f0f2f5; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { background: #fff; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); padding: 40px; max-width: 520px; width: 100%; }
        h1 { font-size: 1.5rem; color: #1a1a2e; margin-bottom: 6px; }
        .subtitle { color: #666; font-size: 0.9rem; margin-bottom: 28px; }
        label { display: block; font-size: 0.85rem; font-weight: 600; color: #333; margin-bottom: 6px; }
        input, textarea, select { width: 100%; padding: 10px 14px; border: 1.5px solid #ddd; border-radius: 8px; font-size: 0.95rem; font-family: inherit; transition: border-color 0.2s; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #4a6cf7; }
        textarea { resize: vertical; min-height: 100px; }
        .field { margin-bottom: 18px; }
        button { width: 100%; padding: 12px; background: #4a6cf7; color: #fff; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #3b5de7; }
        button:disabled { background: #a0b0f0; cursor: not-allowed; }
        .result { margin-top: 24px; padding: 16px; border-radius: 8px; font-size: 0.88rem; display: none; }
        .result.success { display: block; background: #e8f5e9; border: 1px solid #a5d6a7; color: #2e7d32; }
        .result.error { display: block; background: #fce4ec; border: 1px solid #ef9a9a; color: #c62828; }
        .result pre { white-space: pre-wrap; word-break: break-word; margin-top: 8px; background: rgba(0,0,0,0.05); padding: 10px; border-radius: 6px; font-size: 0.82rem; }
        .badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 0.78rem; font-weight: 600; margin-bottom: 8px; }
        .badge.Sales { background: #e3f2fd; color: #1565c0; }
        .badge.Support { background: #fff3e0; color: #e65100; }
        .badge.Spam { background: #fce4ec; color: #c62828; }
        .config { margin-bottom: 20px; padding: 12px; background: #f8f9fa; border-radius: 8px; font-size: 0.82rem; }
        .config label { font-size: 0.78rem; margin-bottom: 4px; color: #666; }
        .config input { padding: 6px 10px; font-size: 0.82rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Lead Intake Form</h1>
        <p class="subtitle">Submit a lead to the AI processing workflow</p>

        <div class="config">
            <label for="webhookUrl">Webhook URL</label>
            <input type="text" id="webhookUrl" value="http://localhost:5678/webhook-test/lead-intake" />
        </div>

        <div class="field">
            <label for="name">Your Name</label>
            <input type="text" id="name" placeholder="e.g., Rahim Ahmed" />
        </div>
        <div class="field">
            <label for="email">Email Address</label>
            <input type="email" id="email" placeholder="e.g., rahim@company.com" />
        </div>
        <div class="field">
            <label for="source">Source</label>
            <select id="source">
                <option value="website">Website</option>
                <option value="email">Email</option>
                <option value="referral">Referral</option>
                <option value="other">Other</option>
            </select>
        </div>
        <div class="field">
            <label for="message">Message</label>
            <textarea id="message" placeholder="e.g., Hi, we need an AI chatbot for our e-commerce platform..."></textarea>
        </div>

        <button id="submitBtn" onclick="submitLead()">Submit Lead</button>

        <div id="result" class="result"></div>
    </div>

    <script>
        async function submitLead() {
            const btn = document.getElementById('submitBtn');
            const resultDiv = document.getElementById('result');
            const webhookUrl = document.getElementById('webhookUrl').value.trim();

            const payload = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                message: document.getElementById('message').value.trim(),
                source: document.getElementById('source').value
            };

            if (!payload.message) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'Please enter a message.';
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Processing (may take 30-60s on first run)...';
            resultDiv.className = 'result';
            resultDiv.style.display = 'none';

            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                resultDiv.className = 'result success';

                const intent = data.intent || 'Unknown';
                resultDiv.innerHTML = `
                    <span class="badge ${intent}">${intent}</span>
                    <strong>Lead ID:</strong> ${data.leadId || 'N/A'}<br><br>
                    <strong>AI Response:</strong><br>${data.aiResponse || data.message || ''}
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>Connection Error:</strong> ${err.message}<br><br>
                    Make sure:<br>
                    &bull; n8n is running at the URL above<br>
                    &bull; You clicked <strong>"Test workflow"</strong> in n8n first (for webhook-test URL)<br>
                    &bull; Or the workflow is <strong>activated</strong> (for production webhook URL)`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Submit Lead';
            }
        }
    </script>
</body>
</html>
